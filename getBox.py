import cv2, numpy
import json

from func import *

#note
# structures =[{'edge': [-0.02857142857142857, -0.02857142857142857, 16.707142857142856, 23.942857142857143], '3': [-0.014285714285714285, 1.0285714285714285, 16.67142857142857, 3.3714285714285714], 'page': [-0.5357142857142857, -0.37857142857142856, 17.72142857142857, 25.057142857142857], '5': [4.2, -0.007142857142857143, 9.028571428571428, 1.0214285714285714], '1': [4.2, 4.414285714285715, 12.457142857142857, 19.478571428571428], '2': [-0.014285714285714285, 4.414285714285715, 4.2, 19.478571428571428], '4': [13.242857142857142, -0.007142857142857143, 3.414285714285714, 1.0214285714285714], 'QR': [0.0, 0.0, 1.0, 1.0], '6': [-0.014285714285714285, -0.007142857142857143, 4.207142857142857, 1.0214285714285714]}, {'8': [-74.0, -53.0, -588.0, -3390.0], 'edge': [-72.0, -50.0, -2339.0, -3396.0], 'page': [-1.0, -1.0, -2481.0, -3508.0], '7': [-664.0, -53.0, -1744.0, -3390.0], 'QR': [-0.0, -0.0, 1.0, 1.0]}]

#note_alt
structures =[{'6': [-4.045454545454546, -0.31601731601731603, 1.274891774891775, 0.30952380952380953], '2': [-4.045454545454546, 1.0238095238095237, 1.2727272727272727, 5.902597402597403], '5': [-2.7683982683982684, -0.31601731601731603, 2.735930735930736, 0.30952380952380953], '1': [-2.7683982683982684, 1.0238095238095237, 3.774891774891775, 5.902597402597403], 'page': [-4.203463203463204, -0.42857142857142855, 5.37012987012987, 7.593073593073593], 'edge': [-4.04978354978355, -0.3225108225108225, 5.062770562770563, 7.255411255411255], '4': [-0.02813852813852814, -0.31601731601731603, 1.0346320346320346, 0.30952380952380953], 'QR': [0.0, 0.0, 1.0, 1.0], '3': [-4.045454545454546, -0.0021645021645021645, 5.0519480519480515, 1.0216450216450217]}, {'edge': [-72.0, -50.0, -2339.0, -3396.0], '8': [-74.0, -53.0, -588.0, -3390.0], '7': [-664.0, -53.0, -1744.0, -3390.0], 'QR': [-0.0, -0.0, 1.0, 1.0], 'page': [-1.0, -1.0, -2481.0, -3508.0]}]


# page=cv2.imread('cache/t2.jpg')
# page=cv2.imread('xxx.jpg')

page=cv2.imread('cache/page_0.jpg')


pageGray=cv2.cvtColor(page,cv2.COLOR_BGR2GRAY)
xc, yc, wc, hc = locateQR(pageGray.copy(), returnArray=0)  # x (QR)code, y (QR)code
hp, wp,Chanel = page.shape  # hp height of page, wp width of page

print([xc, yc, wc, hc])
for name, part in structures[0].items():
    x,y,w,h=part


    # position=[int(x*wc)+xc,int(y*hc)+yc,int(w*wc),int(h*hc)]
    # crop=cropImg(page,position)
    # viewPage(crop)

    page2=page.copy()
    x,y,w,h=[int(x*wc)+xc,int(y*hc)+yc,int(w*wc),int(h*hc)]
    cv2.rectangle(page2, (x, y), (x + w, y + h), (0, 255, 0), 5)

    print(name)
    print(part)
    print([x,y,w,h])
    print("\n")
    viewPage(page2,resize=1)
